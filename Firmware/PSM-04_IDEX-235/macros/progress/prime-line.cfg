[gcode_macro _PRIME_LINE]
gcode:
    {% set prime_x = printer["gcode_macro _USER_VARIABLES"].prime_line_x|float %}
    {% set prime_y = printer["gcode_macro _USER_VARIABLES"].prime_line_y|float %}
    {% set prime_z = printer["gcode_macro _USER_VARIABLES"].prime_line_z|float %}
    {% set prime_distance = printer["gcode_macro _USER_VARIABLES"].prime_line_distance|int %}
    {% set prime_length = printer["gcode_macro _USER_VARIABLES"].prime_line_length|int %}

    {% set prime_x1 = prime_distance * 0.6|float %}
    {% set prime_x2 = prime_distance - prime_x1|float %}
    {% set extrude_1 = prime_length / 2|int %}
    {% set extrude_2 = prime_length - extrude_1|int %}

    {% set travel_speed = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}

    {% if printer.extruder.can_extrude|lower == 'true' %}
        G90
        G0 X{prime_x} Y{prime_y} F{travel_speed}
        G0 Z{prime_z} F300

        SET_STEPPER_ENABLE STEPPER=extruder ENABLE=1
        M400
        M83
        G92 E0.0

        G1 E3 F120
        G92 E0.0

        M400
        G91

        G0 X{prime_x1} E{extrude_1} F1000
        G92 E0.0

        G0 X{prime_x2} E{extrude_2} F1000
        G92 E0.0
        G90

        _WIPE_NOZZLE

    {% else %}
        {action_raise_error("Low temperature")}
    {% endif %}